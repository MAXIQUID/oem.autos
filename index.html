<!<!DOCTYPE html><html lang="en" data-cm-hook="1"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Open ROE VIN Decoder & Parts Explorer | OEM.autos</title><meta name="description" content="Shop OEM Parts Online for All Major Makes and Models and Find All The Parts You Need From Our Complete OEM Parts Catalogs!"><meta property="og:type" content="website"><meta property="og:title" content="Open ROE VIN Decoder & Parts Explorer"><meta property="og:description" content="Shop OEM Parts Online for All Major Makes and Models and Find All The Parts You Need From Our Complete OEM Parts Catalogs!"><meta property="og:url" content="https://OEM.autos/"><meta property="og:site_name" content="OEM.autos"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Open ROE VIN Decoder & Parts Explorer"><meta name="twitter:description" content="Shop OEM Parts Online for All Major Makes and Models and Find All The Parts You Need From Our Complete OEM Parts Catalogs!"><link href="https://OEM.autos/" rel="home"><link href="https://OEM.autos/" rel="canonical"><link type="text/plain" rel="author" href="https://OEM.autos/humans.txt"><meta name="google-site-verification" content="QjdECWw3-_Xw-hlHGCq-J3oewSM_nEbnggKUSuk3QJ4"><meta name="keywords" content="Audi Parts, Acura Parts, Ford Parts, GM Parts, Honda Parts, Hyundai Parts, Mopar Parts, Nissan Parts, Subaru Parts, Toyota Parts, Volkswagen Parts, OEM Parts, OEM Accessories, BMW Parts, Infiniti Parts, Jaguar Parts, Kia Parts, Land Rover Parts, Lexus Parts, Mazda Parts, Mitsubishi Parts, Porsche Parts, Toyota Parts, Volvo Parts, Audi OEM Parts, Acura OEM Parts, Ford OEM Parts, GM OEM Parts, Honda OEM Parts, Hyundai OEM Parts, Mopar OEM Parts, Nissan OEM Parts, Subaru OEM Parts, Toyota OEM Parts, Volkswagen OEM Parts, BMW OEM Parts, Infiniti OEM Parts, Jaguar OEM Parts, Kia OEM Parts, Land Rover OEM Parts, Lexus OEM Parts, Mazda OEM Parts, Mitsubishi OEM Parts, Porsche OEM Parts, Toyota OEM Parts, Volvo OEM Parts, Jeep Parts, Jeep OEM Parts, Ram Parts, Ram OEM Parts, Chrysler Parts, Chrysler OEM Parts, Dodge Parts, Dodge OEM Parts, Porsche Parts, Porsche OEM Parts, Buick Parts, Buick OEM Parts, Chevrolet Parts, Chevy Parts, Chevrolet OEM Parts, Chevy OEM Parts, Cadillac Parts, Cadillac OEM Parts"><meta name="facebook-domain-verification" content="wkh1gmmhsjdto02pjvj9gmah02ckwk"><script src="https://cdn.tailwindcss.com"></script><script src="https://apis.google.com/js/platform.js" async defer></script><script>window.renderBadge=function(){var e=document.createElement("div");document.body.appendChild(e),window.gapi.load("ratingbadge",function(){window.gapi.ratingbadge.render(e,{merchant_id:112083035,position:"BOTTOM_RIGHT"})})};</script><script>(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)},t=l.createElement(r),t.async=1,t.src="https://www.clarity.ms/tag/"+i,y=l.getElementsByTagName(r)[0],y.parentNode.insertBefore(t,y)})(window,document,"clarity","script","lvnxz7z9ep");</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-8WWQDTHJMR"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8WWQDTHJMR");</script><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet"><link rel="shortcut icon" type="image/jpg" href="./favicon.png"><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css"/><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css"/></head> <style>body{font-family:'Inter',sans-serif;background-color:#f8f9fa;margin:0;padding:0;color:#333}#header-main{background-color:#fff;padding:1rem;box-shadow:0 2px 4px rgba(0,0,0,.1)}#header-main img{max-height:50px;border-radius:.375rem}#header-main p{font-weight:700;color:#333}#header-main nav ul{list-style:none;padding:0;margin:0}#header-main nav a{color:#2563EB;text-decoration:none;transition:opacity .2s ease-in-out}#header-main nav a:hover{opacity:.8}.themeMobileNav{display:none;position:absolute;top:0;left:0;width:100%;background-color:#f8f8f8;padding:1rem;border-bottom:1px solid #eee;z-index:50}.themeMobileNav.active{display:block}.themeMobileNav .themeMobileTitle{font-weight:700;margin-bottom:1rem;color:#333}.themeMobileNav ul{list-style:none;padding:0;margin:0}.themeMobileNav li a{display:block;padding:.75rem 0;border-bottom:1px solid #eee;color:#333;text-decoration:none}.themeMobileNav li:last-child a{border-bottom:none}.themeHamburger{display:none;cursor:pointer;position:absolute;right:1rem;top:1.5rem;z-index:60;width:30px;height:20px;flex-direction:column;justify-content:space-between}.themeHamburger span{display:block;width:100%;height:3px;background-color:#333;border-radius:.125rem}#sticky-nav{background-color:#2D3748;padding:.5rem 0;box-shadow:0 2px 4px rgba(0,0,0,.1)}#sticky-nav ul{list-style:none;padding:0;margin:0}#sticky-nav a{color:#fff;text-decoration:none;transition:background-color .2s ease-in-out;border-radius:.375rem}#sticky-nav a:hover{background-color:#1A202C}.topPageSection{padding:2rem 1rem;max-width:1200px;margin:2rem auto;background-color:#fff;border-radius:.5rem;box-shadow:0 4px 6px rgba(0,0,0,.1)}.topPageContentTitle h2{font-size:2rem;font-weight:700;color:#333;margin-bottom:.5rem}.topPageContentTitle p{font-size:1.125rem;color:#6B7280;margin-bottom:1.5rem}.topPageContent p{font-size:1rem;line-height:1.6;color:#4B5563;margin-bottom:1rem}#exit-intent-popup{display:none;z-index:1000}#exit-intent{background-color:#fff;padding:2rem;border-radius:.5rem;box-shadow:0 5px 15px rgba(0,0,0,.3);max-width:500px;text-align:center}header.vin-decoder-header{background-color:#003366;color:#fff;padding:20px;text-align:center;font-size:1.5rem;border-radius:.5rem;margin-bottom:20px}main.vin-decoder-main{padding:20px;max-width:1000px;margin:auto}.input-group{display:flex;gap:1rem;margin-bottom:1rem;flex-wrap:wrap}.input-group input{flex:1;padding:10px;font-size:1.1rem;border-radius:6px;border:2px solid #0074d9;min-width:200px}.input-group button{padding:10px 20px;font-size:1.1rem;color:#fff;background-color:#0074d9;border:none;border-radius:6px;cursor:pointer;font-weight:700;transition:background-color .2s ease-in-out}.input-group button:hover{background-color:#0056b3}#vehicleInfo{margin-top:20px;padding:20px;background-color:#fff;border-radius:6px;box-shadow:0 4px 10px rgba(0,0,0,.1)}#vehicleInfo h2{margin-top:0;color:#003366}.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px;margin-top:20px}.card{background-color:#fff;border-radius:6px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,.1);text-align:center;transition:transform .2s ease-in-out}.card:hover{transform:scale(1.03)}.card img{width:100%;height:150px;object-fit:cover;border-radius:6px 6px 0 0}.caption{padding:10px}.caption strong{color:#003366}.caption .tag{display:inline-block;background-color:#ffe28a;padding:3px 8px;font-size:.8rem;margin-top:5px;border-radius:5px}.error{color:red;font-size:1.1rem;margin-top:20px}.ebay-link{text-decoration:none;color:#0074d9;font-size:.9rem;font-weight:700}.ebay-link:hover{color:#0056b3}.dropdown{margin-bottom:1rem;display:flex;flex-direction:column}.dropdown label{font-weight:700;margin-bottom:.5rem;color:#333}.dropdown select{padding:10px;font-size:1.1rem;border-radius:6px;border:2px solid #0074d9;background-color:#fff;cursor:pointer}.dropdown select:disabled{background-color:#e9ecef;cursor:not-allowed}.carousel{margin-top:20px;padding:10px;background-color:#fff;border-radius:6px;box-shadow:0 4px 10px rgba(0,0,0,.1)}.carousel-item{padding:10px;text-align:center}.part-card{background-color:#f8f9fa;border-radius:6px;box-shadow:0 2px 5px rgba(0,0,0,.1);padding:10px;transition:transform .2s ease-in-out}.part-card:hover{transform:translateY(-5px)}.part-card img{width:100%;height:100px;object-fit:cover;border-radius:4px;margin-bottom:10px}.part-card h3{font-size:1rem;font-weight:700;color:#003366;margin:0}footer{text-align:center;background-color:#003366;color:#fff;padding:10px;width:100%;bottom:0;margin-top:2rem;border-radius:.5rem .5rem 0 0}footer p{margin:0}footer a{color:#ffe28a;font-weight:700;text-decoration:none}footer a:hover{text-decoration:underline}@media(max-width:1023px){#header-main{flex-direction:column;align-items:flex-start;position:relative}#header-main nav{display:none}.themeHamburger{display:flex}.sticky-wrap{display:none!important}}@media(max-width:767px){.search-container{flex-direction:column}.dropdown,.search-box,.search-button{min-width:unset;width:100%}.input-group{flex-direction:column}}</style>
</head>
<header lang="en" aria-label="OEM.autos site header" itemscope itemtype="https://schema.org/Organization" style="font-family:sans-serif;background:#f8f9fa;">
  <div style="max-width:1200px;margin:auto;display:flex;flex-wrap:wrap;justify-between;align-items:center;padding:0.5rem 1rem;">
    <a href="./index.html" style="display:flex;align-items:center;text-decoration:none;" itemprop="url">
      <img src="./images/logo.webp" alt="OEM.autos Logo" style="height:40px;border-radius:4px;margin-right:0.5rem;" itemprop="logo">
      <span style="color:red;font-weight:bold;font-size:1.25rem;" itemprop="name">OEM.autos</span>
    </a>
    <div style="display:flex;align-items:center;gap:0.5rem;">
      <button aria-label="Open Cart" style="padding:0.5rem 1rem;background:#28a745;color:#fff;border:none;border-radius:4px;cursor:pointer;" onclick="alert('Cart popup placeholder')">Order</button>
      <button aria-label="Open Menu" style="display:flex;flex-direction:column;justify-content:space-between;width:24px;height:18px;border:none;background:none;cursor:pointer;">
        <span style="height:2px;background:#333;width:100%;border-radius:1px;"></span>
        <span style="height:2px;background:#333;width:100%;border-radius:1px;"></span>
        <span style="height:2px;background:#333;width:100%;border-radius:1px;"></span>
      </button>
    </div>
  </div>
  <nav aria-label="Vehicle Brand Navigation" style="overflow-x:auto;background:#343a40;">
    <ul style="display:flex;gap:0.25rem;padding:0.25rem;margin:0;list-style:none;white-space:nowrap;">
      <li><a href="https://acura.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Acura</a></li>
      <li><a href="https://audi.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Audi</a></li>
      <li><a href="https://bmw.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">BMW</a></li>
      <li><a href="https://ford.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Ford</a></li>
      <li><a href="https://g.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">GM</a></li>
      <li><a href="https://honda.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Honda</a></li>
      <li><a href="https://hyundai.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Hyundai</a></li>
      <li><a href="https://infiniti.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Infiniti</a></li>
      <li><a href="https://jaguar.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Jaguar</a></li>
      <li><a href="https://kia.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Kia</a></li>
      <li><a href="https://landrover.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Land Rover</a></li>
      <li><a href="https://lexus.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Lexus</a></li>
      <li><a href="https://mazda.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Mazda</a></li>
      <li><a href="https://mitsubishi.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Mitsubishi</a></li>
      <li><a href="https://mopar.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Mopar</a></li>
      <li><a href="https://nissan.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Nissan</a></li>
      <li><a href="https://porsche.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Porsche</a></li>
      <li><a href="https://subaru.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Subaru</a></li>
      <li><a href="https://toyota.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Toyota</a></li>
      <li><a href="https://vw.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Volkswagen</a></li>
      <li><a href="https://volvo.oem.autos/?utm_source=splash&amp;utm_medium=main-nav" style="padding:0.5rem 0.75rem;color:#fff;text-decoration:none;font-weight:600;text-transform:uppercase;font-size:0.75rem;">Volvo</a></li>
    </ul>
  </nav>
</header>
    <div class="mx-auto flex items-center justify-center">
        <div id="homepage" class="w-full">
            <main>
                <!-- VIN Decoder Section (now the primary content) -->
                <section class="topPageSection">
                    <header class="vin-decoder-header">
                        <h1>search vehicle with vin or ymm </h1>
                        <p>Your source for Open Source Auto Parts Data & Recycling</p>
                    </header>
                    <main class="vin-decoder-main">
                        <div class="input-group">
                            <input type="text" id="vinInput" placeholder="Enter 17-character VIN..." maxlength="17" class="rounded-md" />
                            <button id="decodeBtn" class="rounded-md">Decode VIN</button>
                        </div>
                        <div id="vehicleInfo"></div>
                        <h2 class="text-center mt-8 mb-4">Select Auto Parts</h2>
                        <div class="dropdown-group flex flex-wrap justify-center gap-4 mb-8">
                            <div class="dropdown">
                                <label for="location">Location</label>
                                <select id="location" class="rounded-md">
                                    <option value="">--Select Location--</option>
                                    <option value="Engine">Engine</option>
                                    <option value="Interior">Interior</option>
                                    <option value="Exterior">Exterior</option>
                                    <option value="Suspension">Suspension</option>
                                    <option value="Electrical">Electrical</option>
                                    <option value="Braking">Braking</option>
                                </select>
                            </div>
                            <div class="dropdown">
                                <label for="partType">Part Type</label>
                                <select id="partType" disabled class="rounded-md">
                                    <option value="">--Select Part Type--</option>
                                </select>
                            </div>
                            <div class="dropdown">
                                <label for="specificPart">Specific Part</label>
                                <select id="specificPart" disabled class="rounded-md">
                                    <option value="">--Select Specific Part--</option>
                                </select>
                            </div>
                        </div>
                        <div id="partsCarousel" class="carousel">
                            <!-- Parts will be populated here -->
                        </div>
                        <div id="partsGrid" class="grid"></div>
                    </main>
                </section>
                <!-- End VIN Decoder Section -->

                <!-- Original Page Content from OEMautos (retained for general info) -->
                <section class="topPageSection">
                    <div class="topPageContainer">
                        <div class="topPageContentTitle">
                            <h2>Shop Genuine Parts </h2>
                            <p>at Discounted Pricing</p>
                        </div>
                        <div class="topPageContent">
                            <p>At OEMautos, we make it easier to shop for auto parts online. Find the right part at the right price by searching our collection of OEM catalogs by part name, part number, or your VIN. Each brand is powered by our network of dealership parts departments to ensure full inventory availability and fast shipping speeds nationwide.</p><p>Don't wait longer than you need to for your parts , shop with OEMautos today. Select your brand to start shopping!</p>
                        </div>
                    </div>
                </section>
                <!-- end of Page Content -->
            </main>
            <div id="exit-intent-popup" class="popup fixed inset-0 flex items-center justify-center p-4 bg-black bg-opacity-80 z-50">
                <article id="exit-intent" class="relative bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-xl font-bold mb-4">Don't Leave Yet!</h3>
                    <p class="mb-4">Get exclusive discounts on OEM parts when you sign up for our newsletter.</p>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200 close-button">Sign Up & Save</button>
                    <button class="text-gray-600 mt-2 block mx-auto close-button">No, thanks</button>
                </article>
            </div>
        </div>
    </div>

    <!-- Combined Footer -->
    <footer>
        <p>Open ROE - Open Source Auto Parts Recycling Database | <a href="https://github.com/OpenROE" target="_blank">GitHub Repository</a></p>
    </footer>

    <!-- jQuery and Slick Carousel CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>

    <!-- Inlined Custom JavaScript -->
    <script>
        // Data for part dropdowns and carousel
        const partsList = {
            Engine: {
                "Sensors": ["Mass Air Flow Sensor", "Throttle Body", "Oil Pressure Sensor"],
                "Cooling": ["Radiator", "Water Pump", "Thermostat"],
                "Fuel System": ["Fuel Injector", "Fuel Pump", "Fuel Filter"],
                "Transmission": ["Torque Converter", "Transmission Cooler", "Transmission Pump"],
            },
            Interior: {
                "Seats": ["Seat (Bucket)", "Seat (Bench)", "Seat Belt"],
                "Dashboard": ["Instrument Cluster", "Speedometer", "Tachometer"],
                "Electrical": ["Fuse Box", "Ignition Switch", "Interior Light"],
                "Controls": ["Shift Lever", "Pedal Cluster", "Steering Wheel"],
            },
            Exterior: {
                "Body Panels": ["Fender", "Door", "Hood", "Trunk"],
                "Mirrors": ["Side View Mirror", "Interior Mirror"],
                "Lights": ["Headlight", "Tail Light", "Fog Light"],
                "Glass": ["Windshield", "Side Window", "Rear Window"],
            },
            Suspension: {
                "Arms": ["Control Arm (Front)", "Lower Control Arm (Rear)"],
                "Shocks": ["Shock Absorber", "Strut Mount"],
                "Steering": ["Steering Column", "Steering Rack", "Steering Knuckle"],
            },
            Electrical: {
                "Control Units": ["Body Control Module", "Engine Control Module"],
                "Sensors": ["ABS Sensor", "Airbag Sensor", "Speed Sensor"],
                "Motors": ["Wiper Motor", "Window Motor", "Blower Motor"],
            },
            Braking: {
                "Components": ["Brake Caliper", "Brake Rotor", "Brake Pads"],
                "System Parts": ["Master Cylinder", "Brake Booster", "ABS Module"],
            }
        };

<script>
/*
  FuelEconomy YMMO cascade for OEM.autos
  - Uses FuelEconomy.gov WS at /ws/rest/vehicle/menu/*
  - Expects XML responses; parses with DOMParser
  - Replaces the old "partsList" cascade with Year → Make → Model → Options (trims)
  - Integrates with existing VIN decode flow (NHTSA) to pre-select year/make/model when available
  - Keeps existing carousel initialization / teardown code (Slick)
*/

/* --- DOM elements --- */
const vinInput = document.getElementById("vinInput");
const decodeBtn = document.getElementById("decodeBtn");
const vehicleInfo = document.getElementById("vehicleInfo");
const partsGrid = document.getElementById("partsGrid");         // kept for legacy sample grid
const partsCarousel = document.getElementById("partsCarousel");

// New YMMO selects - replace your old location/partType/specificPart
const yearSelect = document.getElementById('year');            // previously location
const makeSelect = document.getElementById('make');            // previously partType
const modelSelect = document.getElementById('model');          // previously specificPart
const optionsSelect = document.getElementById('options');      // final trim/options (maps to parts carousel items)

/* --- Utility: fetch XML and parse menuItems --- */
async function fetchMenu(endpoint) {
    // endpoint should be a full URL starting with https://www.fueleconomy.gov/ws/rest/vehicle/menu/...
    try {
        const res = await fetch(endpoint, { cache: "no-cache" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const text = await res.text();
        const parser = new DOMParser();
        const xml = parser.parseFromString(text, "application/xml");
        // menuItem nodes: <menuItem><text>2010</text><value>2010</value></menuItem>
        const items = Array.from(xml.getElementsByTagName('menuItem')).map(mi => {
            const textNode = mi.getElementsByTagName('text')[0];
            const valueNode = mi.getElementsByTagName('value')[0];
            return {
                text: textNode ? textNode.textContent.trim() : (valueNode ? valueNode.textContent.trim() : ''),
                value: valueNode ? valueNode.textContent.trim() : (textNode ? textNode.textContent.trim() : '')
            };
        });
        return items;
    } catch (err) {
        console.error('fetchMenu error', endpoint, err);
        return [];
    }
}

/* --- Helper: clear and add options to a select --- */
function populateSelect(selectEl, items, placeholderText) {
    selectEl.innerHTML = '';
    const placeholder = document.createElement('option');
    placeholder.value = '';
    placeholder.textContent = placeholderText || '-- Select --';
    selectEl.appendChild(placeholder);
    items.forEach(it => {
        const opt = document.createElement('option');
        opt.value = it.value;
        opt.textContent = it.text;
        selectEl.appendChild(opt);
    });
    selectEl.disabled = items.length === 0;
}

/* --- Slick destroy helper (keeps your existing pattern) --- */
function destroyCarouselIfNeeded() {
    if (!partsCarousel) return;
    if (window.jQuery && $(partsCarousel).hasClass('slick-initialized')) {
        $(partsCarousel).slick('unslick');
    }
    partsCarousel.innerHTML = '';
}

/* --- Populate carousel with option/trims (and link to eBay search for convenience) --- */
function displayOptionsInCarousel(optionItems, make, model, year) {
    destroyCarouselIfNeeded();
    if (!optionItems || optionItems.length === 0) {
        partsCarousel.innerHTML = '<p class="text-center text-gray-600">No trims/options found for this selection.</p>';
        return;
    }
    optionItems.forEach(opt => {
        const txt = opt.text || opt.value;
        const query = encodeURIComponent(`${year} ${make} ${model} ${txt}`);
        const el = document.createElement('div');
        el.className = 'carousel-item';
        el.innerHTML = `
            <div class="part-card rounded-md">
                <img src="https://placehold.co/150x100/0074d9/FFFFFF?text=${encodeURIComponent(txt)}" alt="${txt}" class="rounded-md">
                <h3 class="mt-2">${txt}</h3>
                <a href="https://www.ebay.com/sch/i.html?_nkw=${query}" target="_blank" class="ebay-link">Search on eBay</a>
            </div>
        `;
        partsCarousel.appendChild(el);
    });

    // init slick after a short timeout
    setTimeout(() => {
        if (window.jQuery && typeof $(partsCarousel).slick === 'function') {
            $(partsCarousel).slick({
                slidesToShow: 3,
                slidesToScroll: 1,
                infinite: true,
                dots: true,
                autoplay: true,
                autoplaySpeed: 2000,
                responsive: [
                    { breakpoint: 1024, settings: { slidesToShow: 2 } },
                    { breakpoint: 600, settings: { slidesToShow: 1 } }
                ]
            });
        }
    }, 80);
}

/* --- FuelEconomy endpoints helpers --- */
const FE_BASE = 'https://www.fueleconomy.gov/ws/rest/vehicle/menu';

/* Year list */
async function loadYears() {
    const url = `${FE_BASE}/year`;
    const years = await fetchMenu(url);
    populateSelect(yearSelect, years, '-- Select Year --');
}

/* Makes for a year */
async function loadMakesForYear(year, preselectMake) {
    if (!year) {
        populateSelect(makeSelect, [], '-- Select Make --');
        populateSelect(modelSelect, [], '-- Select Model --');
        populateSelect(optionsSelect, [], '-- Select Option --');
        return;
    }
    const url = `${FE_BASE}/make?year=${encodeURIComponent(year)}`;
    const makes = await fetchMenu(url);
    populateSelect(makeSelect, makes, '-- Select Make --');

    if (preselectMake) {
        const found = Array.from(makeSelect.options).find(o => o.value.toLowerCase() === preselectMake.toLowerCase());
        if (found) {
            makeSelect.value = found.value;
            makeSelect.dispatchEvent(new Event('change'));
        }
    }
}

/* Models for year + make */
async function loadModelsForYearMake(year, make, preselectModel) {
    if (!year || !make) {
        populateSelect(modelSelect, [], '-- Select Model --');
        populateSelect(optionsSelect, [], '-- Select Option --');
        return;
    }
    const url = `${FE_BASE}/model?year=${encodeURIComponent(year)}&make=${encodeURIComponent(make)}`;
    const models = await fetchMenu(url);
    populateSelect(modelSelect, models, '-- Select Model --');

    if (preselectModel) {
        const found = Array.from(modelSelect.options).find(o => o.value.toLowerCase() === preselectModel.toLowerCase());
        if (found) {
            modelSelect.value = found.value;
            modelSelect.dispatchEvent(new Event('change'));
        }
    }
}

/* Options / trims for year + make + model */
async function loadOptionsForYMM(year, make, model, preselectOptionValue) {
    if (!year || !make || !model) {
        populateSelect(optionsSelect, [], '-- Select Option --');
        displayOptionsInCarousel([], make, model, year);
        return;
    }
    const url = `${FE_BASE}/options?year=${encodeURIComponent(year)}&make=${encodeURIComponent(make)}&model=${encodeURIComponent(model)}`;
    const options = await fetchMenu(url);
    populateSelect(optionsSelect, options, '-- Select Trim / Option --');

    // show all options in carousel
    displayOptionsInCarousel(options, make, model, year);

    if (preselectOptionValue) {
        const found = Array.from(optionsSelect.options).find(o => o.value.toLowerCase() === preselectOptionValue.toLowerCase());
        if (found) {
            optionsSelect.value = found.value;
        }
    }
}

/* --- Wire up select change events for cascade --- */
yearSelect.addEventListener('change', async () => {
    const year = yearSelect.value;
    // clear downstream selects and carousel while loading
    populateSelect(makeSelect, [], '-- Loading Makes --');
    populateSelect(modelSelect, [], '-- Select Model --');
    populateSelect(optionsSelect, [], '-- Select Option --');
    destroyCarouselIfNeeded();
    if (year) {
        await loadMakesForYear(year);
    } else {
        // no year selected — clear everything
        populateSelect(makeSelect, [], '-- Select Make --');
        populateSelect(modelSelect, [], '-- Select Model --');
        populateSelect(optionsSelect, [], '-- Select Option --');
        destroyCarouselIfNeeded();
    }
});

makeSelect.addEventListener('change', async () => {
    const year = yearSelect.value;
    const make = makeSelect.value;
    populateSelect(modelSelect, [], '-- Loading Models --');
    populateSelect(optionsSelect, [], '-- Select Option --');
    destroyCarouselIfNeeded();
    if (year && make) {
        await loadModelsForYearMake(year, make);
    } else {
        populateSelect(modelSelect, [], '-- Select Model --');
        populateSelect(optionsSelect, [], '-- Select Option --');
    }
});

modelSelect.addEventListener('change', async () => {
    const year = yearSelect.value;
    const make = makeSelect.value;
    const model = modelSelect.value;
    populateSelect(optionsSelect, [], '-- Loading Options --');
    destroyCarouselIfNeeded();
    if (year && make && model) {
        await loadOptionsForYMM(year, make, model);
    } else {
        populateSelect(optionsSelect, [], '-- Select Option --');
        destroyCarouselIfNeeded();
    }
});

optionsSelect.addEventListener('change', () => {
    // When a specific trim/option is selected, update carousel to just that selection
    const selected = optionsSelect.value;
    const year = yearSelect.value;
    const make = makeSelect.value;
    const model = modelSelect.value;

    destroyCarouselIfNeeded();
    if (selected) {
        // Show only the selected option as a single-item carousel
        displayOptionsInCarousel([{ text: selected, value: selected }], make, model, year);
    } else {
        // If cleared, show all options for current YMM
        if (year && make && model) {
            loadOptionsForYMM(year, make, model);
        }
    }
});

/* --- VIN decode integration --- */
decodeBtn.addEventListener("click", () => {
    const vin = vinInput.value.trim().toUpperCase();
    if (vin.length !== 17) {
        vehicleInfo.innerHTML = '<p class="error">VIN must be exactly 17 characters.</p>';
        partsGrid.innerHTML = '';
        destroyCarouselIfNeeded();
        return;
    }
    decodeVINandSelectYMM(vin);
});

async function decodeVINandSelectYMM(vin) {
    vehicleInfo.innerHTML = "<p>Loading vehicle info...</p>";
    partsGrid.innerHTML = "";
    destroyCarouselIfNeeded();

    try {
        const res = await fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/decodevinvalues/${encodeURIComponent(vin)}?format=json`);
        const json = await res.json();
        const data = json.Results[0] || {};
        const make = data.Make || "";
        const model = data.Model || "";
        const year = data.ModelYear || ""; // ModelYear is usually integer or string
        // Extract WMI, VDS, VIS from VIN (for display)
        const wmi = vin.slice(0, 3);
        const vds = vin.slice(3, 9);
        const vis = vin.slice(9);

        vehicleInfo.innerHTML = `
            <h2>${make || 'Unknown'} ${model || ''} (${year || 'Unknown'})</h2>
            <p><strong>WMI:</strong> ${wmi} | <strong>VDS:</strong> ${vds} | <strong>VIS:</strong> ${vis}</p>
        `;

        // Load Year list (if not loaded) and attempt to pre-select year/make/model from VIN decode
        // We'll load years then attempt to load makes/models/options with preselection chain.
        await loadYears();

        // Preselect Year (match exact)
        if (year) {
            const foundYear = Array.from(yearSelect.options).find(o => o.value === year || o.text === String(year));
            if (foundYear) {
                yearSelect.value = foundYear.value;
                // load makes with preselect for make
                await loadMakesForYear(foundYear.value, make);
                // If make now selected, models will auto-load and we attempt to preselect model
                // But loadMakesForYear dispatches change (which triggers model loading) only if we set the value and dispatch a change.
                // To be safe, attempt explicit model load as well:
                if (makeSelect.value) {
                    await loadModelsForYearMake(yearSelect.value, makeSelect.value, model);
                    if (modelSelect.value) {
                        await loadOptionsForYMM(yearSelect.value, makeSelect.value, modelSelect.value);
                    }
                }
                return;
            }
        }

        // If we couldn't preselect, just ensure the lists are available for manual selection
        // Load makes for default (no preselect)
        // (Do not overwrite user selection if already set)
        if (!yearSelect.value) {
            // keep years loaded and let the user choose
        }

    } catch (err) {
        console.error("Error decoding VIN:", err);
        vehicleInfo.innerHTML = '<p class="error">Failed to fetch vehicle data. Please check your VIN or try again later.</p>';
    }
}

/* --- Initial page load: load years and show a default sample grid --- */
document.addEventListener('DOMContentLoaded', async function() {
    await loadYears();

    // Optional: populate a sample partsGrid (legacy) while user picks Y/M/M/O
    generateExamplePartsGrid("VIN", "WMI"); // your original sample grid function (keeps previous behavior)

    // If you want an initial default YMM (e.g., current year), you can set yearSelect.value programmatically
    // and call yearSelect.dispatchEvent(new Event('change')); but leaving blank is often better UX.
});

/* --- Keep the existing generateExamplePartsGrid function (copied from your original script) --- */
function generateExamplePartsGrid(make, wmi) {
    const exampleParts = [
        { code: "AWZ", name: "Windshield Washer Zone", category: "Exterior", ebay: "https://www.ebay.com/sch/i.html?_nkw=windshield+washer+zone" },
        { code: "BDY", name: "Front Body Panel", category: "Body", ebay: "https://www.ebay.com/sch/i.html?_nkw=front+body+panel" },
        { code: "DRL", name: "Daytime Running Light", category: "Electrical", ebay: "https://www.ebay.com/sch/i.html?_nkw=daytime+running+light" },
        { code: "ENB", name: "Engine Block", category: "Engine", ebay: "https://www.ebay.com/sch/i.html?_nkw=engine+block" },
        { code: "TRN", name: "Transmission Unit", category: "Transmission", ebay: "https://www.ebay.com/sch/i.html?_nkw=transmission+unit" },
        { code: "RAX", name: "Rear Axle Assembly", category: "Suspension", ebay: "https://www.ebay.com/sch/i.html?_nkw=rear+axle+assembly" },
        { code: "SRS", name: "Airbag System", category: "Safety", ebay: "https://www.ebay.com/sch/i.html?_nkw=airbag+system" },
        { code: "EXH", name: "Exhaust Manifold", category: "Exhaust", ebay: "https://www.ebay.com/sch/i.html?_nkw=exhaust+manifold" }
    ];

    if (partsGrid) {
        partsGrid.innerHTML = ""; // Clear existing grid content
        exampleParts.forEach(part => {
            const code = `${wmi}-${part.code}`;
            const img = `https://placehold.co/300x150/003366/FFFFFF?text=${encodeURIComponent(part.code)}`;
            const card = document.createElement("div");
            card.className = "card rounded-md";
            card.innerHTML = `
                <a href="${part.ebay}" target="_blank" title="Search ${part.name} on eBay">
                    <img src="${img}" alt="${part.name}" class="rounded-t-md" />
                    <div class="caption">
                        <strong>${code}</strong><br />
                        <span>${part.name}</span><br />
                        <span class="tag rounded-md">${part.category}</span>
                    </div>
                </a>
            `;
            partsGrid.appendChild(card);
        });
    }
}
    </script>
</body>
</html>
